language: java
cache:
  directories:
  - "$HOME/.m2"
jdk:
- oraclejdk8
before_script:
- pip install --user codecov
- sudo apt-get update -qq
- sudo apt-get install -qq genisoimage
- sudo apt-get install -qq curl
script:
- mvn package -pl ugs-platform/application -P create-autoupdate,create-dmg -DskipTests=true
- curl -fL https://getcli.jfrog.io | sh
- "./jfrog rt config --interactive=false --url $ARTIFACTORY_URL --apikey $ARTIFACTORY_API_KEY
  $ARTIFACTORY_SERVER_ID"
- ./jfrog rt u "ugs-core/target/UniversalGcodeSender.jar" "/ugs/dist/" --build-name=$ARTIFACTORY_NAME
  --build-number=$TRAVIS_BUILD_NUMBER --flat=true
- ./jfrog rt u "ugs-platform/application/target/ugs-platform-app-*.zip" "/ugs/dist/"
  --build-name=$ARTIFACTORY_NAME --build-number=$TRAVIS_BUILD_NUMBER --flat=true
- ./jfrog rt u "ugs-platform/application/target/ugs-platform-app-*.dmg" "/ugs/dist/"
  --build-name=$ARTIFACTORY_NAME --build-number=$TRAVIS_BUILD_NUMBER --flat=true
- ./jfrog rt u "ugs-platform/application/target/site/netbeans_site/" "/ugs/update-center/"
  --build-name=$ARTIFACTORY_NAME --build-number=$TRAVIS_BUILD_NUMBER
- "./jfrog rt bce $ARTIFACTORY_NAME $TRAVIS_BUILD_NUMBER"
- "./jfrog rt bp $ARTIFACTORY_NAME $TRAVIS_BUILD_NUMBER"
after_success:
- codecov
- mvn package -pl ugs-core assembly:assembly
- mvn install
env:
  global:
  - ARTIFACTORY_NAME=ugs
  - JFROG_CLI_OFFER_CONFIG=false
